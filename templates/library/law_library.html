{% extends "base_nyaya.html" %}

{% block title %}Law Library - Understand Indian Laws in Simple Language{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Header Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="bg-gradient-primary text-white rounded p-4 mb-4">
                <h1 class="display-4 fw-bold mb-3">Law Library</h1>
                <p class="lead mb-0">Understand Indian laws in simple language. Search for everyday topics like "bike accident", "property dispute", or "consumer rights".</p>
            </div>
        </div>
    </div>

    <!-- Search and Filter Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-body">
                    <form method="GET" action="{{ url_for('law_library') }}">
                        <div class="row g-3">
                            <!-- Search Box -->
                            <div class="col-md-6">
                                <label for="search" class="form-label">Search Legal Topics</label>
                                <input type="text" class="form-control form-control-lg" id="search" name="q" 
                                       value="{{ query }}" placeholder="Try: bike accident, property dispute, consumer rights...">
                            </div>
                            
                            <!-- Category Filter -->
                            <div class="col-md-3">
                                <label for="category" class="form-label">Category</label>
                                <select class="form-select" id="category" name="category">
                                    <option value="">All Categories</option>
                                    {% for cat in categories %}
                                        <option value="{{ cat }}" {% if cat == selected_category %}selected{% endif %}>
                                            {{ cat }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                            
                            <!-- State Filter -->
                            <div class="col-md-3">
                                <label for="state" class="form-label">State</label>
                                <select class="form-select" id="state" name="state">
                                    <option value="">All States</option>
                                    {% for state in states %}
                                        <option value="{{ state }}" {% if state == selected_state %}selected{% endif %}>
                                            {{ state }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        
                        <div class="row mt-3">
                            <div class="col-12">
                                <button type="submit" class="btn btn-primary btn-lg me-2">
                                    <i class="fas fa-search"></i> Search Laws
                                </button>
                                <a href="{{ url_for('law_library') }}" class="btn btn-outline-secondary">
                                    <i class="fas fa-refresh"></i> Clear Filters
                                </a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Popular Topics Section -->
    {% if not query %}
    <div class="row mb-4">
        <div class="col-12">
            <h3 class="mb-3">Popular Legal Topics</h3>
            <div class="d-flex flex-wrap gap-2 mb-4">
                <a href="?q=bike accident" class="btn btn-outline-primary btn-sm">üèçÔ∏è Bike Accident</a>
                <a href="?q=property dispute" class="btn btn-outline-primary btn-sm">üè† Property Dispute</a>
                <a href="?q=consumer rights" class="btn btn-outline-primary btn-sm">üõí Consumer Rights</a>
                <a href="?q=domestic violence" class="btn btn-outline-primary btn-sm">üë© Domestic Violence</a>
                <a href="?q=employment rights" class="btn btn-outline-primary btn-sm">üíº Job Rights</a>
                <a href="?q=police complaint" class="btn btn-outline-primary btn-sm">üëÆ Police Complaint</a>
                <a href="?q=cybercrime" class="btn btn-outline-primary btn-sm">üíª Online Fraud</a>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Results Section -->
    <div class="row">
        <div class="col-12">
            {% if query %}
                <h3 class="mb-3">Search Results for "{{ query }}"</h3>
                {% if law_cards|length == 0 %}
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i>
                        No laws found for your search. Try using different keywords or browse popular topics above.
                    </div>
                {% endif %}
            {% else %}
                <h3 class="mb-3">All Legal Topics</h3>
            {% endif %}

            <!-- Law Cards Grid -->
            <div class="row">
                {% for law in law_cards %}
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="card h-100 shadow-sm hover-card">
                        <div class="card-body">
                            <!-- Category Badge -->
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <span class="badge bg-primary">{{ law.category }}</span>
                                <small class="text-muted">{{ law.state }}</small>
                            </div>
                            
                            <!-- Title and Summary -->
                            <h5 class="card-title text-dark">{{ law.title }}</h5>
                            <p class="card-text text-muted">{{ law.summary }}</p>
                        </div>
                        
                        <div class="card-footer bg-transparent">
                            <a href="{{ url_for('law_detail', law_id=law.id) }}" class="btn btn-primary btn-sm">
                                <i class="fas fa-book-open"></i> Read More
                            </a>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Quick Help Section -->
    <div class="row mt-5">
        <div class="col-12">
            <div class="card bg-light">
                <div class="card-body text-center">
                    <h4 class="card-title">Need Specific Legal Help?</h4>
                    <p class="card-text">Can't find what you're looking for? Ask our AI legal assistant or connect with a qualified lawyer.</p>
                    <div class="btn-group" role="group">
                        <a href="{{ url_for('chat') }}" class="btn btn-primary">
                            <i class="fas fa-robot"></i> Ask AI Assistant
                        </a>
                        <a href="{{ url_for('find_lawyer') }}" class="btn btn-success">
                            <i class="fas fa-user-tie"></i> Find a Lawyer
                        </a>
                        <a href="{{ url_for('emergency_help') }}" class="btn btn-danger">
                            <i class="fas fa-phone"></i> Emergency Help
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.hover-card {
    transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
}

.hover-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
}

.bg-gradient-primary {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.form-control-lg, .form-select {
    border-radius: 8px;
}

.btn {
    border-radius: 6px;
}

.card {
    border-radius: 10px;
    border: none;
}

.badge {
    font-size: 0.75rem;
    padding: 0.35em 0.65em;
}

.card-footer {
    border-top: 1px solid rgba(0,0,0,0.05);
}
</style>

<script>
// Auto-submit form when filters change
document.getElementById('category').addEventListener('change', function() {
    this.form.submit();
});

document.getElementById('state').addEventListener('change', function() {
    this.form.submit();
});

// Search suggestions
const searchInput = document.getElementById('search');
const suggestions = [
    'bike accident', 'car accident', 'property dispute', 'land dispute',
    'consumer rights', 'domestic violence', 'employment rights', 'salary issues',
    'police complaint', 'FIR', 'cybercrime', 'online fraud', 'harassment',
    'divorce', 'child custody', 'rent dispute', 'eviction', 'medical negligence'
];

searchInput.addEventListener('input', function() {
    // Simple search enhancement - could be expanded with a proper autocomplete
    const value = this.value.toLowerCase();
    if (value.length > 2) {
        // This could be enhanced with a dropdown of suggestions
        console.log('Searching for:', value);
    }
});
</script>
{% endblock %}